import{c as $,r,p as A,a as we,t as x,j as e,B as T,A as X,b as ee,T as Se,d as ke,e as U,f as V,C as p,g as j,h as b,i as v,k as ae,L as H,I as se,S as Ce,l as Me,m as De,n as Te,o as F}from"./index-GVDjicHU.js";import{f as C,P as te,a as re,C as le,b as ne,c as ce,D as me,d as ue,e as ge,g as pe,h as je,B as W,S as fe,i as Pe,s as ie,j as Be,k as $e,R as Ee,l as Fe,m as Ae,T as Le,L as Ke,n as de,U as oe,o as Re}from"./ProfileTab-CFTUsnsI.js";import{U as L,F as O,B as q,W as J,D as Ie}from"./wheat-D8G3INRI.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]],_e=$("apple",Oe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],_=$("coffee",ze);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Y=$("info",Ue);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],We=$("leaf",Ve);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],Z=$("moon",He);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 21a9 9 0 0 0 9-9H3a9 9 0 0 0 9 9Z",key:"4rw317"}],["path",{d:"M11.38 12a2.4 2.4 0 0 1-.4-4.77 2.4 2.4 0 0 1 3.2-2.77 2.4 2.4 0 0 1 3.47-.63 2.4 2.4 0 0 1 3.37 3.37 2.4 2.4 0 0 1-1.1 3.7 2.51 2.51 0 0 1 .03 1.1",key:"10xrj0"}],["path",{d:"m13 12 4-4",key:"1hckqy"}],["path",{d:"M10.9 7.25A3.99 3.99 0 0 0 4 10c0 .73.2 1.41.54 2",key:"1p4srx"}]],qe=$("salad",Ye);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],xe=$("sparkles",Je);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],he=$("wallet",Ze);function Ge({accessToken:k,onPurchase:s,profile:u}){const[h,i]=r.useState(new Date),[l,w]=r.useState(null),[d,n]=r.useState(!1),[t,P]=r.useState(null),[E,S]=r.useState(!1),[M,D]=r.useState({breakfast:[],lunch:[],supper:[]}),[N,K]=r.useState(!1),[c,m]=r.useState("breakfast");r.useEffect(()=>{o(h)},[h]),r.useEffect(()=>{l?.items&&g()},[l,u?.dietPreference]);const o=async a=>{n(!0);try{const y=C(a,"yyyy-MM-dd"),B=await fetch(`https://${A}.supabase.co/functions/v1/make-server-493cc528/menu/${y}`,{headers:{Authorization:`Bearer ${we}`}});if(B.ok){const R=await B.json();w(R)}}catch(y){console.error("Error fetching menu:",y),x.error("Failed to load menu")}finally{n(!1)}},g=async()=>{K(!0);try{const a=C(h,"yyyy-MM-dd"),B=["breakfast","lunch","supper"].map(async I=>{const z=await fetch(`https://${A}.supabase.co/functions/v1/make-server-493cc528/recommendations`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({date:a,mealType:I})});if(z.ok){const ve=await z.json();return{mealType:I,data:ve}}return{mealType:I,data:{recommendations:[]}}}),R=await Promise.all(B),f={};R.forEach(({mealType:I,data:z})=>{f[I]=z.recommendations||[]}),D(f)}catch(a){console.error("Error fetching recommendations:",a)}finally{K(!1)}},G=async a=>{try{const y=await fetch(`https://${A}.supabase.co/functions/v1/make-server-493cc528/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({itemName:a.name,amount:a.price,category:a.category,nutritionInfo:a.nutrition})});if(y.ok)x.success(`Purchased ${a.name} for KES ${a.price}!`),S(!1),s();else{const B=await y.json();x.error(`Purchase failed: ${B.error}`)}}catch(y){console.error("Error making purchase:",y),x.error("An error occurred during purchase")}},Ne=a=>{switch(a){case"breakfast":return _;case"lunch":return L;case"supper":return Z;default:return L}},ye=a=>{switch(a){case"breakfast":return"text-yellow-600";case"lunch":return"text-orange-600";case"supper":return"text-purple-600";default:return"text-gray-600"}},Q=a=>{const y=M[a]||[],B=Ne(a),R=ye(a);return N?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):y.length===0?e.jsxs(X,{children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs(ee,{children:["No recommendations available for ",a,". This might be because there are no menu items that match your diet preference and budget, or no items are available for this meal type."]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(xe,{className:"w-5 h-5 text-orange-500"}),e.jsx("h3",{className:"font-medium",children:"Recommended for You"})]}),y.map(f=>e.jsx(p,{className:"hover:shadow-md transition-shadow cursor-pointer border-2 border-orange-200 bg-gradient-to-br from-orange-50 to-white",onClick:()=>{P(f),S(!0)},children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(B,{className:`w-4 h-4 ${R} flex-shrink-0`}),e.jsx("h4",{className:"truncate",children:f.name}),e.jsx(xe,{className:"w-4 h-4 text-orange-500 flex-shrink-0"})]}),f.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:f.description}),f.nutrition&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 bg-red-100 text-red-700 rounded flex items-center gap-1",children:[e.jsx(O,{className:"w-3 h-3"}),f.nutrition.calories," cal"]}),e.jsxs("span",{className:"text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),f.nutrition.protein,"g protein"]}),e.jsxs("span",{className:"text-xs px-2 py-1 bg-yellow-100 text-yellow-700 rounded flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),f.nutrition.carbs,"g carbs"]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("div",{className:"text-orange-600 font-medium",children:["KES ",f.price]}),e.jsx(W,{className:"mt-1 bg-green-100 text-green-800 text-xs",children:"Within Budget"})]})]})})},f.id))]})},be=()=>!l?.items||l.items.length===0?e.jsxs(X,{children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx(ee,{children:"No menu items available for this date."})]}):e.jsx("div",{className:"space-y-3",children:l.items.map(a=>e.jsx(p,{className:`hover:shadow-md transition-shadow cursor-pointer ${a.available===!1?"opacity-50":""}`,onClick:()=>{a.available!==!1&&(P(a),S(!0))},children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"truncate mb-1",children:a.name}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:a.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx(W,{variant:"secondary",className:"text-xs",children:a.category}),a.available===!1&&e.jsx(W,{className:"bg-red-100 text-red-800 text-xs",children:"Unavailable"})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("div",{className:"text-orange-600 font-medium",children:["KES ",a.price]})})]})})},a.id))});return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1 text-lg sm:text-xl",children:"Today's Menu"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Personalized recommendations based on your preferences"})]}),e.jsxs(te,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"gap-2 w-full sm:w-auto",children:[e.jsx(le,{className:"w-4 h-4"}),C(h,"PPP")]})}),e.jsx(ne,{className:"w-auto p-0",children:e.jsx(ce,{mode:"single",selected:h,onSelect:a=>a&&i(a)})})]})]}),u?.dietPreference&&e.jsxs(X,{className:"border-blue-200 bg-blue-50",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-600"}),e.jsxs(ee,{className:"text-blue-800",children:["Showing recommendations for your ",e.jsx("strong",{children:u.dietPreference})," diet preference."]})]}),d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs(Se,{value:c,onValueChange:m,children:[e.jsxs(ke,{className:"grid w-full grid-cols-4",children:[e.jsxs(U,{value:"breakfast",className:"gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Breakfast"})]}),e.jsxs(U,{value:"lunch",className:"gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Lunch"})]}),e.jsxs(U,{value:"supper",className:"gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Supper"})]}),e.jsxs(U,{value:"all",className:"gap-2",children:[e.jsx("span",{className:"hidden sm:inline",children:"All Items"}),e.jsx("span",{className:"sm:hidden",children:"All"})]})]}),e.jsx(V,{value:"breakfast",className:"mt-4",children:Q("breakfast")}),e.jsx(V,{value:"lunch",className:"mt-4",children:Q("lunch")}),e.jsx(V,{value:"supper",className:"mt-4",children:Q("supper")}),e.jsx(V,{value:"all",className:"mt-4",children:be()})]}),e.jsx(me,{open:E,onOpenChange:S,children:e.jsxs(ue,{children:[e.jsxs(ge,{children:[e.jsx(pe,{children:t?.name}),e.jsx(je,{children:t?.description||"Cafeteria menu item"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-600",children:"Price"}),e.jsxs("span",{className:"text-orange-600 font-medium",children:["KES ",t.price]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Category"}),e.jsx("div",{children:e.jsx(W,{children:t.category})})]}),t.nutrition&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Nutritional Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(O,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Calories"})]}),e.jsx("p",{className:"font-medium",children:t.nutrition.calories})]}),e.jsxs("div",{className:"p-3 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Protein"})]}),e.jsxs("p",{className:"font-medium",children:[t.nutrition.protein,"g"]})]}),e.jsxs("div",{className:"p-3 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(J,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Carbs"})]}),e.jsxs("p",{className:"font-medium",children:[t.nutrition.carbs,"g"]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Fats"}),e.jsxs("p",{className:"font-medium",children:[t.nutrition.fats,"g"]})]})]})]}),e.jsxs(T,{onClick:()=>G(t),disabled:t.available===!1,className:"w-full bg-orange-500 hover:bg-orange-600 gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),t.available===!1?"Unavailable":`Purchase for KES ${t.price}`]})]})]})})]})}function Qe({accessToken:k}){const[s,u]=r.useState(!1),[h,i]=r.useState(!1),[l,w]=r.useState("150"),[d,n]=r.useState("200"),[t,P]=r.useState("150");r.useEffect(()=>{E()},[]);const E=async()=>{u(!0);try{const c=await fetch(`https://${A}.supabase.co/functions/v1/make-server-493cc528/meal-budgets`,{headers:{Authorization:`Bearer ${k}`}});if(c.ok){const m=await c.json();w(m.breakfast.toString()),n(m.lunch.toString()),P(m.supper.toString())}else{const m=await c.json();x.error(`Failed to fetch budgets: ${m.error}`)}}catch(c){console.error("Error fetching meal budgets:",c),x.error("An error occurred while fetching budgets")}finally{u(!1)}},S=async()=>{const c=parseFloat(l),m=parseFloat(d),o=parseFloat(t);if(isNaN(c)||c<=0){x.error("Please enter a valid breakfast budget");return}if(isNaN(m)||m<=0){x.error("Please enter a valid lunch budget");return}if(isNaN(o)||o<=0){x.error("Please enter a valid supper budget");return}i(!0);try{const g=await fetch(`https://${A}.supabase.co/functions/v1/make-server-493cc528/meal-budgets`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({breakfast:c,lunch:m,supper:o})});if(g.ok)x.success("Meal budgets updated successfully!");else{const G=await g.json();x.error(`Update failed: ${G.error}`)}}catch(g){console.error("Error updating meal budgets:",g),x.error("An error occurred while updating budgets")}finally{i(!1)}},M=(parseFloat(l)||0)+(parseFloat(d)||0)+(parseFloat(t)||0),D=M,N=M*7,K=M*30;return s?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1 text-lg sm:text-xl",children:"Meal Budget Management"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Set your budget for each meal type"})]}),e.jsxs("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-3",children:[e.jsxs(p,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(v,{className:"text-sm",children:"Daily Budget"})}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-orange-600",children:["KES ",D.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Per day"})]})]}),e.jsxs(p,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(v,{className:"text-sm",children:"Weekly Budget"})}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-orange-600",children:["KES ",N.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Per week"})]})]}),e.jsxs(p,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(v,{className:"text-sm",children:"Monthly Budget"})}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-orange-600",children:["KES ",K.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Per month (approx)"})]})]})]}),e.jsxs(p,{children:[e.jsxs(b,{children:[e.jsx(v,{children:"Set Meal Budgets"}),e.jsx(ae,{children:"Configure your budget for breakfast, lunch, and supper"})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex gap-3",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Your meal budgets help the recommendation system suggest affordable options. These budgets are used to filter menu items within your price range."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"breakfast-budget",children:"Breakfast Budget"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Typical: KES 100-200"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"KES"}),e.jsx(se,{id:"breakfast-budget",type:"number",value:l,onChange:c=>w(c.target.value),className:"pl-14",placeholder:"150",min:"0",step:"10"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"lunch-budget",children:"Lunch Budget"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Typical: KES 150-300"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"KES"}),e.jsx(se,{id:"lunch-budget",type:"number",value:d,onChange:c=>n(c.target.value),className:"pl-14",placeholder:"200",min:"0",step:"10"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(Z,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{htmlFor:"supper-budget",children:"Supper Budget"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Typical: KES 100-200"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"KES"}),e.jsx(se,{id:"supper-budget",type:"number",value:t,onChange:c=>P(c.target.value),className:"pl-14",placeholder:"150",min:"0",step:"10"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Daily Budget:"}),e.jsxs("span",{className:"text-orange-600",children:["KES ",D.toFixed(2)]})]}),e.jsxs(T,{onClick:S,disabled:h,className:"w-full bg-orange-500 hover:bg-orange-600 gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),h?"Saving...":"Save Budgets"]})]})]})]}),e.jsxs(p,{children:[e.jsx(b,{children:e.jsx(v,{children:"Budget Tips"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsx("p",{className:"text-gray-700",children:"Set realistic budgets based on your typical meal costs"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsx("p",{className:"text-gray-700",children:"Lunch usually costs more than breakfast or supper"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsx("p",{className:"text-gray-700",children:"Review your analytics regularly to adjust budgets"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500 mt-1.5 flex-shrink-0"}),e.jsx("p",{className:"text-gray-700",children:"The recommendation system will only suggest items within your budget"})]})]})})]})]})}function Xe({accessToken:k}){const[s,u]=r.useState(null),[h,i]=r.useState(!1),[l,w]=r.useState("30days"),[d,n]=r.useState(void 0),[t,P]=r.useState(void 0),[E,S]=r.useState(!1),[M,D]=r.useState(!1);r.useEffect(()=>{N()},[l,d,t]);const N=async()=>{i(!0);try{let c=`https://${A}.supabase.co/functions/v1/make-server-493cc528/student/analytics`;if(l==="custom"&&d&&t)c+=`?startDate=${C(d,"yyyy-MM-dd")}&endDate=${C(t,"yyyy-MM-dd")}`;else if(l!=="all"){const o=new Date;let g;switch(l){case"today":g=o;break;case"week":g=$e(o);break;case"month":g=Be(o);break;case"7days":g=ie(o,7);break;case"30days":g=ie(o,30);break;default:g=o}c+=`?startDate=${C(g,"yyyy-MM-dd")}&endDate=${C(o,"yyyy-MM-dd")}`}const m=await fetch(c,{headers:{Authorization:`Bearer ${k}`}});if(!m.ok){const o=await m.json();x.error(`Failed: ${o.error}`);return}u(await m.json())}catch{x.error("Could not fetch analytics")}finally{i(!1)}},K=()=>{if(!s)return x.error("No data to export");const c=[["MealPal Student Analytics Report"],["Generated",new Date().toLocaleString()],[],["Category","Value"],["Total Transactions",s.totalTransactions],["Total Spending (KES)",s.totalSpending.toFixed(2)],["Average Transaction (KES)",s.averageTransactionValue.toFixed(2)],["Breakfast Spending",s.breakfastSpending.toFixed(2)],["Lunch Spending",s.lunchSpending.toFixed(2)],["Supper Spending",s.supperSpending.toFixed(2)],["Beverages",s.beverageSpending.toFixed(2)],["Desserts",s.dessertSpending.toFixed(2)],[],["Nutritional Totals"],["Calories",s.nutritionTotals.calories],["Protein (g)",s.nutritionTotals.protein.toFixed(1)],["Carbs (g)",s.nutritionTotals.carbs.toFixed(1)],["Fats (g)",s.nutritionTotals.fats.toFixed(1)]].map(g=>g.join(",")).join(`
`),m=new Blob([c],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(m),o.download=`student-analytics-${C(new Date,"yyyy-MM-dd")}.csv`,o.click(),x.success("Report exported")};return h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):s?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl",children:"My Analytics"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Track your spending & nutrition"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{onClick:N,variant:"outline",className:"gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"})," Refresh"]}),e.jsxs(T,{onClick:K,className:"bg-orange-500 gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"})," Export"]})]})]}),e.jsxs(p,{children:[e.jsx(b,{children:e.jsx(v,{className:"text-base",children:"Date Range"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(Ce,{value:l,onValueChange:w,children:[e.jsx(Me,{className:"w-[200px]",children:e.jsx(De,{})}),e.jsxs(Te,{children:[e.jsx(F,{value:"all",children:"All Time"}),e.jsx(F,{value:"today",children:"Today"}),e.jsx(F,{value:"7days",children:"Last 7 Days"}),e.jsx(F,{value:"30days",children:"Last 30 Days"}),e.jsx(F,{value:"week",children:"This Week"}),e.jsx(F,{value:"month",children:"This Month"}),e.jsx(F,{value:"custom",children:"Custom"})]})]}),l==="custom"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{open:E,onOpenChange:S,children:[e.jsx(re,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),d?C(d,"PP"):"Start Date"]})}),e.jsx(ne,{className:"p-0",children:e.jsx(ce,{mode:"single",selected:d,onSelect:c=>{n(c),S(!1)},disabled:[{after:new Date}]})})]}),e.jsxs(te,{open:M,onOpenChange:D,children:[e.jsx(re,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),t?C(t,"PP"):"End Date"]})}),e.jsx(ne,{className:"p-0",children:e.jsx(ce,{mode:"single",selected:t,onSelect:c=>{P(c),D(!1)},disabled:[{after:new Date},...d?[{before:d}]:[]]})})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(p,{children:[e.jsxs(b,{className:"flex justify-between",children:[e.jsx(v,{className:"text-sm",children:"Total Spending"}),e.jsx(Ae,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(j,{children:e.jsxs("div",{className:"text-orange-600",children:["KES ",s.totalSpending.toFixed(2)]})})]}),e.jsxs(p,{children:[e.jsxs(b,{className:"flex justify-between",children:[e.jsx(v,{className:"text-sm",children:"Transactions"}),e.jsx(fe,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-orange-600",children:s.totalTransactions})})]}),e.jsxs(p,{children:[e.jsxs(b,{className:"flex justify-between",children:[e.jsx(v,{className:"text-sm",children:"Avg Spent"}),e.jsx(Le,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(j,{children:e.jsxs("div",{className:"text-orange-600",children:["KES ",s.averageTransactionValue.toFixed(2)]})})]}),e.jsxs(p,{children:[e.jsxs(b,{className:"flex justify-between",children:[e.jsx(v,{className:"text-sm",children:"Calories"}),e.jsx(O,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-orange-600",children:s.nutritionTotals.calories})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsxs(b,{children:[e.jsx(v,{children:"Spending by Meal"}),e.jsx(ae,{children:"Breakdown of your expenses"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between p-3 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(_,{className:"w-5 h-5 text-yellow-600"})," Breakfast"]}),e.jsxs("span",{children:["KES ",s.breakfastSpending.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(L,{className:"w-5 h-5 text-orange-600"})," Lunch"]}),e.jsxs("span",{children:["KES ",s.lunchSpending.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(Z,{className:"w-5 h-5 text-purple-600"})," Supper"]}),e.jsxs("span",{children:["KES ",s.supperSpending.toFixed(2)]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Beverages"})," ",e.jsxs("span",{children:["KES ",s.beverageSpending.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Desserts"})," ",e.jsxs("span",{children:["KES ",s.dessertSpending.toFixed(2)]})]})]})]})]}),e.jsxs(p,{children:[e.jsxs(b,{children:[e.jsx(v,{children:"Nutrition Summary"}),e.jsx(ae,{children:"Your nutritional totals"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(O,{className:"w-5 h-5 text-red-600"})," Calories"]}),e.jsx("span",{children:s.nutritionTotals.calories})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(q,{className:"w-5 h-5 text-orange-600"})," Protein"]}),e.jsxs("span",{children:[s.nutritionTotals.protein.toFixed(1),"g"]})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(J,{className:"w-5 h-5 text-yellow-600"})," Carbs"]}),e.jsxs("span",{children:[s.nutritionTotals.carbs.toFixed(1),"g"]})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-600"})," Fats"]}),e.jsxs("span",{children:[s.nutritionTotals.fats.toFixed(1),"g"]})]})]})]})]})]}):e.jsx(p,{children:e.jsx(j,{className:"py-12",children:e.jsx("p",{className:"text-center text-gray-500",children:"No analytics data available"})})})}const es=[{value:"normal",label:"Normal Diet",description:"Balanced meals with all food groups",icon:_e,color:"text-green-600"},{value:"vegetarian",label:"Vegetarian",description:"Plant-based with dairy and eggs",icon:qe,color:"text-green-500"},{value:"vegan",label:"Vegan",description:"Strictly plant-based foods",icon:We,color:"text-emerald-600"},{value:"keto",label:"Keto",description:"Very low carb, high fat",icon:O,color:"text-red-600"},{value:"low-carb",label:"Low Carb",description:"Reduced carbohydrate intake",icon:J,color:"text-yellow-600"},{value:"high-protein",label:"High Protein",description:"Protein-rich meals for fitness",icon:q,color:"text-orange-600"}];function ss({open:k,onComplete:s,accessToken:u}){const[h,i]=r.useState("normal"),[l,w]=r.useState(!1),d=async()=>{w(!0);try{const n=await fetch(`https://${A}.supabase.co/functions/v1/make-server-493cc528/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({dietPreference:h})});if(n.ok)x.success("Diet preference saved!"),s(h);else{const t=await n.json();x.error(`Failed to save: ${t.error}`)}}catch(n){console.error("Error saving diet preference:",n),x.error("An error occurred while saving")}finally{w(!1)}};return e.jsx(me,{open:k,onOpenChange:()=>{},children:e.jsxs(ue,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",onInteractOutside:n=>n.preventDefault(),children:[e.jsxs(ge,{children:[e.jsx(pe,{children:"Welcome to MealPal! ðŸ½ï¸"}),e.jsx(je,{children:"Let's personalize your experience. Choose your preferred diet to get tailored meal recommendations."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx(H,{children:"Select Your Diet Preference"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:es.map(n=>{const t=n.icon;return e.jsx("button",{onClick:()=>i(n.value),className:`p-4 border-2 rounded-lg text-left transition-all ${h===n.value?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(t,{className:`w-6 h-6 ${n.color} flex-shrink-0 mt-1`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium mb-1",children:n.label}),e.jsx("p",{className:"text-sm text-gray-600",children:n.description})]}),h===n.value&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-orange-500 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},n.value)})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ’¡ Tip:"})," Your diet preference will help us recommend meals that match your nutritional goals and restrictions. You can always change this later in your profile settings."]})}),e.jsx(T,{onClick:d,disabled:l,className:"w-full bg-orange-500 hover:bg-orange-600",children:l?"Saving...":"Continue to Dashboard"})]})]})})}function ls({user:k,profile:s,accessToken:u,onSignOut:h}){const[i,l]=r.useState("menu"),[w,d]=r.useState(!1),[n,t]=r.useState(s),[P,E]=r.useState(0);r.useEffect(()=>{s.dietPreference||d(!0)},[s]);const S=N=>{d(!1),t({...n,dietPreference:N})},M=N=>{t(N)},D=()=>{E(N=>N+1)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx("header",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white shadow-lg",children:e.jsx("div",{className:"max-w-md mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-6 h-6"}),e.jsx("h1",{className:"text-xl sm:text-2xl",children:"MealPal"})]}),e.jsxs("p",{className:"text-sm text-orange-100 mt-1",children:["Welcome back, ",n.name,"!"]})]}),e.jsxs(T,{variant:"ghost",size:"sm",onClick:h,className:"text-white hover:bg-orange-600 gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})]})})}),e.jsx("nav",{className:"bg-white border-b sticky top-0 z-10 shadow-sm",children:e.jsxs("div",{className:"flex overflow-x-auto",children:[e.jsxs("button",{onClick:()=>l("menu"),className:`flex-1 py-3 px-4 flex flex-col items-center gap-1 ${i==="menu"?"text-orange-600 border-b-2 border-orange-600 bg-orange-50":"text-gray-600"}`,children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Menu"})]}),e.jsxs("button",{onClick:()=>l("budget"),className:`flex-1 py-3 px-4 flex flex-col items-center gap-1 ${i==="budget"?"text-orange-600 border-b-2 border-orange-600 bg-orange-50":"text-gray-600"}`,children:[e.jsx(he,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Budget"})]}),e.jsxs("button",{onClick:()=>l("analytics"),className:`flex-1 py-3 px-4 flex flex-col items-center gap-1 ${i==="analytics"?"text-orange-600 border-b-2 border-orange-600 bg-orange-50":"text-gray-600"}`,children:[e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Analytics"})]}),e.jsxs("button",{onClick:()=>l("profile"),className:`flex-1 py-3 px-4 flex flex-col items-center gap-1 ${i==="profile"?"text-orange-600 border-b-2 border-orange-600 bg-orange-50":"text-gray-600"}`,children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Profile"})]})]})}),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("aside",{className:"hidden w-64 bg-white border-r",children:e.jsxs("nav",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:()=>l("menu"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${i==="menu"?"bg-orange-500 text-white":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{children:"Menu"})]}),e.jsxs("button",{onClick:()=>l("budget"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${i==="budget"?"bg-orange-500 text-white":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(he,{className:"w-5 h-5"}),e.jsx("span",{children:"Budget"})]}),e.jsxs("button",{onClick:()=>l("analytics"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${i==="analytics"?"bg-orange-500 text-white":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{children:"Analytics"})]}),e.jsxs("button",{onClick:()=>l("profile"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${i==="profile"?"bg-orange-500 text-white":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile"})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"max-w-md mx-auto px-4 py-4",children:[i==="menu"&&e.jsx(Ge,{accessToken:u,onPurchase:D,profile:n}),i==="budget"&&e.jsx(Qe,{accessToken:u}),i==="analytics"&&e.jsx(Xe,{accessToken:u}),i==="profile"&&e.jsx(Re,{profile:n,accessToken:u,onProfileUpdate:M})]})})]}),e.jsx(ss,{open:w,onComplete:S,accessToken:u})]})}export{ls as StudentDashboard};
