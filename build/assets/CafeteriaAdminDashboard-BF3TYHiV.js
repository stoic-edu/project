import{c as he,j as e,q as Q,r,u as xe,s as De,v as Ee,P as me,w as Ae,x as Me,y as Te,p as z,a as Y,C as F,h as I,i as R,k as q,B as x,g as $,L as M,I as B,S as Z,l as ee,m as se,n as ae,o as k,t as f}from"./index-GVDjicHU.js";import{P as ue,T as pe,U as Pe,S as Fe,a as $e,M as Ie,b as Re}from"./sheet-wigWzPHD.js";import{f as A,P as te,a as re,C as ne,b as ie,c as le,D as je,d as ge,e as fe,g as ve,h as ye,s as ce,j as Be,k as ze,R as Ue,l as Le,m as Oe,S as _e,T as Ke,L as oe,o as Ve,n as He,U as We}from"./ProfileTab-CFTUsnsI.js";import{F as qe,B as Ge,W as Je,D as Xe,U as de}from"./wheat-D8G3INRI.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Ye=he("database",Qe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],G=he("plus",Ze);function es({className:o,...s}){return e.jsx("textarea",{"data-slot":"textarea",className:Q("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",o),...s})}var J="Switch",[ss]=Ee(J),[as,ts]=ss(J),Ne=r.forwardRef((o,s)=>{const{__scopeSwitch:d,name:m,checked:c,defaultChecked:h,required:g,disabled:n,value:N="on",onCheckedChange:u,form:p,...v}=o,[S,b]=r.useState(null),C=xe(s,i=>b(i)),D=r.useRef(!1),T=S?p||!!S.closest("form"):!0,[l,w]=De({prop:c,defaultProp:h??!1,onChange:u,caller:J});return e.jsxs(as,{scope:d,checked:l,disabled:n,children:[e.jsx(me.button,{type:"button",role:"switch","aria-checked":l,"aria-required":g,"data-state":Ce(l),"data-disabled":n?"":void 0,disabled:n,value:N,...v,ref:C,onClick:Ae(o.onClick,i=>{w(j=>!j),T&&(D.current=i.isPropagationStopped(),D.current||i.stopPropagation())})}),T&&e.jsx(Se,{control:S,bubbles:!D.current,name:m,value:N,checked:l,required:g,disabled:n,form:p,style:{transform:"translateX(-100%)"}})]})});Ne.displayName=J;var be="SwitchThumb",we=r.forwardRef((o,s)=>{const{__scopeSwitch:d,...m}=o,c=ts(be,d);return e.jsx(me.span,{"data-state":Ce(c.checked),"data-disabled":c.disabled?"":void 0,...m,ref:s})});we.displayName=be;var rs="SwitchBubbleInput",Se=r.forwardRef(({__scopeSwitch:o,control:s,checked:d,bubbles:m=!0,...c},h)=>{const g=r.useRef(null),n=xe(g,h),N=Me(d),u=Te(s);return r.useEffect(()=>{const p=g.current;if(!p)return;const v=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(v,"checked").set;if(N!==d&&b){const C=new Event("click",{bubbles:m});b.call(p,d),p.dispatchEvent(C)}},[N,d,m]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:d,...c,tabIndex:-1,ref:n,style:{...c.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Se.displayName=rs;function Ce(o){return o?"checked":"unchecked"}var ns=Ne,is=we;function ls({className:o,...s}){return e.jsx(ns,{"data-slot":"switch",className:Q("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",o),...s,children:e.jsx(is,{"data-slot":"switch-thumb",className:Q("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function cs({accessToken:o}){const[s,d]=r.useState(new Date),[m,c]=r.useState(null),[h,g]=r.useState([]),[n,N]=r.useState(!1),[u,p]=r.useState(!1),[v,S]=r.useState(null),[b,C]=r.useState(""),[D,T]=r.useState(""),[l,w]=r.useState(""),[i,j]=r.useState("Main Course"),[O,_]=r.useState(!0),[U,H]=r.useState("none");r.useEffect(()=>{W(s),K()},[s]);const W=async a=>{N(!0);try{const E=A(a,"yyyy-MM-dd"),L=await fetch(`https://${z}.supabase.co/functions/v1/make-server-493cc528/menu/${E}`,{headers:{Authorization:`Bearer ${Y}`}});if(L.ok){const P=await L.json();c(P)}}catch(E){console.error("Error fetching menu:",E)}finally{N(!1)}},K=async()=>{try{const a=await fetch(`https://${z}.supabase.co/functions/v1/make-server-493cc528/nutrition`,{headers:{Authorization:`Bearer ${Y}`}});if(a.ok){const E=await a.json();g(E)}}catch(a){console.error("Error fetching nutrition data:",a)}},X=async()=>{if(!b.trim()){f.error("Please enter an item name");return}if(!l||parseFloat(l)<=0){f.error("Please enter a valid price");return}const a={id:v?.id||crypto.randomUUID(),name:b.trim(),description:D.trim(),price:parseFloat(l),category:i,available:O,nutrition:U&&U!=="none"?h.find(P=>P.id===U):null},E=m?.items||[];let L;v?L=E.map(P=>P.id===v.id?a:P):L=[...E,a];try{const P=await fetch(`https://${z}.supabase.co/functions/v1/make-server-493cc528/menu`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({date:A(s,"yyyy-MM-dd"),items:L})});if(P.ok)f.success(v?"Menu item updated!":"Menu item added!"),W(s),y(),p(!1);else{const ke=await P.json();f.error(`Save failed: ${ke.error}`)}}catch(P){console.error("Error saving menu:",P),f.error("An error occurred while saving")}},t=async a=>{if(confirm("Are you sure you want to delete this menu item?"))try{const E=await fetch(`https://${z}.supabase.co/functions/v1/make-server-493cc528/menu/${A(s,"yyyy-MM-dd")}/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}});if(E.ok)f.success("Menu item deleted!"),W(s);else{const L=await E.json();f.error(`Delete failed: ${L.error}`)}}catch(E){console.error("Error deleting menu item:",E),f.error("An error occurred while deleting")}},y=()=>{C(""),T(""),w(""),j("Main Course"),_(!0),H("none"),S(null)},V=a=>{S(a),C(a.name),T(a.description||""),w(a.price.toString()),j(a.category),_(a.available!==!1),H(a.nutrition?.id||"none"),p(!0)};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs(F,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-lg sm:text-xl",children:"Menu Management"}),e.jsx(q,{className:"text-sm",children:"Create and manage daily menus"})]}),e.jsxs(x,{onClick:()=>{y(),p(!0)},className:"bg-orange-500 hover:bg-orange-600 gap-2 w-full sm:w-auto",size:"sm",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Item"]})]})}),e.jsxs($,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs(te,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"gap-2 w-full sm:w-auto text-sm",children:[e.jsx(ne,{className:"w-4 h-4"}),A(s,"PPP")]})}),e.jsx(ie,{className:"w-auto p-0",children:e.jsx(le,{mode:"single",selected:s,onSelect:a=>a&&d(a)})})]})}),n?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):!m||!m.items||m.items.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No menu items for this date"}),e.jsxs(x,{onClick:()=>{y(),p(!0)},variant:"outline",className:"gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Add First Item"]})]}):e.jsx("div",{className:"space-y-3",children:m.items.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{children:a.name}),e.jsx("span",{className:"text-xs px-2 py-1 bg-orange-100 text-orange-800 rounded",children:a.category}),a.available===!1&&e.jsx("span",{className:"text-xs px-2 py-1 bg-red-100 text-red-800 rounded",children:"Unavailable"})]}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description}),a.nutrition&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a.nutrition.calories," cal | ",a.nutrition.protein,"g protein"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-orange-600",children:["KES ",a.price]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>V(a),children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>t(a.id),className:"text-red-600 hover:text-red-700",children:e.jsx(pe,{className:"w-4 h-4"})})]})]},a.id))})]})]}),e.jsx(je,{open:u,onOpenChange:a=>{p(a),a||y()},children:e.jsxs(ge,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(fe,{children:[e.jsx(ve,{children:v?"Edit Menu Item":"Add Menu Item"}),e.jsx(ye,{children:v?"Update the menu item details":"Add a new item to the cafeteria menu"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"item-name",children:"Item Name *"}),e.jsx(B,{id:"item-name",value:b,onChange:a=>C(a.target.value),placeholder:"e.g., Chicken Biryani"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"item-price",children:"Price (KES) *"}),e.jsx(B,{id:"item-price",type:"number",value:l,onChange:a=>w(a.target.value),placeholder:"150"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"item-description",children:"Description"}),e.jsx(es,{id:"item-description",value:D,onChange:a=>T(a.target.value),placeholder:"Brief description of the dish"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"item-category",children:"Category *"}),e.jsxs(Z,{value:i,onValueChange:j,children:[e.jsx(ee,{id:"item-category",children:e.jsx(se,{})}),e.jsxs(ae,{children:[e.jsx(k,{value:"Main Course",children:"Main Course"}),e.jsx(k,{value:"Side Dish",children:"Side Dish"}),e.jsx(k,{value:"Beverage",children:"Beverage"}),e.jsx(k,{value:"Dessert",children:"Dessert"}),e.jsx(k,{value:"Breakfast",children:"Breakfast"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"item-nutrition",children:"Nutrition Info"}),e.jsxs(Z,{value:U,onValueChange:H,children:[e.jsx(ee,{id:"item-nutrition",children:e.jsx(se,{placeholder:"Select nutrition data (optional)"})}),e.jsxs(ae,{children:[e.jsx(k,{value:"none",children:"None"}),h.map(a=>e.jsxs(k,{value:a.id,children:[a.name," (",a.calories," cal)"]},a.id))]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{id:"item-available",checked:O,onCheckedChange:_}),e.jsx(M,{htmlFor:"item-available",children:"Available for purchase"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(x,{onClick:X,className:"flex-1 bg-orange-500 hover:bg-orange-600",disabled:!b||!l,children:v?"Update Item":"Add Item"}),e.jsx(x,{variant:"outline",onClick:()=>{p(!1),y()},children:"Cancel"})]})]})]})})]})}function os({accessToken:o}){const[s,d]=r.useState([]),[m,c]=r.useState(!1),[h,g]=r.useState(!1),[n,N]=r.useState(null),[u,p]=r.useState(""),[v,S]=r.useState(""),[b,C]=r.useState(""),[D,T]=r.useState(""),[l,w]=r.useState(""),[i,j]=r.useState(""),[O,_]=r.useState("");r.useEffect(()=>{U()},[]);const U=async()=>{c(!0);try{const t=await fetch(`https://${z}.supabase.co/functions/v1/make-server-493cc528/nutrition`,{headers:{Authorization:`Bearer ${Y}`}});if(t.ok){const y=await t.json();d(y)}}catch(t){console.error("Error fetching nutrition data:",t)}finally{c(!1)}},H=async()=>{const t={name:u,calories:parseInt(v),protein:parseFloat(b),carbs:parseFloat(D),fats:parseFloat(l),fiber:parseFloat(i)||0,sodium:parseFloat(O)||0};try{const y=n?`https://${z}.supabase.co/functions/v1/make-server-493cc528/nutrition/${n.id}`:`https://${z}.supabase.co/functions/v1/make-server-493cc528/nutrition`,V=await fetch(y,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(t)});if(V.ok)f.success(n?"Nutrition data updated!":"Nutrition data added!"),U(),K(),g(!1);else{const a=await V.json();f.error(`Save failed: ${a.error}`)}}catch(y){console.error("Error saving nutrition data:",y),f.error("An error occurred while saving")}},W=async t=>{if(confirm("Are you sure you want to delete this nutrition entry?"))try{const y=await fetch(`https://${z}.supabase.co/functions/v1/make-server-493cc528/nutrition/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}});if(y.ok)f.success("Nutrition data deleted!"),U();else{const V=await y.json();f.error(`Delete failed: ${V.error}`)}}catch(y){console.error("Error deleting nutrition data:",y),f.error("An error occurred while deleting")}},K=()=>{p(""),S(""),C(""),T(""),w(""),j(""),_(""),N(null)},X=t=>{N(t),p(t.name),S(t.calories?.toString()||""),C(t.protein?.toString()||""),T(t.carbs?.toString()||""),w(t.fats?.toString()||""),j(t.fiber?.toString()||""),_(t.sodium?.toString()||""),g(!0)};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs(F,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-lg sm:text-xl",children:"Nutrition Database"}),e.jsx(q,{className:"text-sm",children:"Manage nutritional information"})]}),e.jsxs(x,{onClick:()=>{K(),g(!0)},className:"bg-orange-500 hover:bg-orange-600 gap-2 w-full sm:w-auto",size:"sm",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Entry"]})]})}),e.jsx($,{children:m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):s.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No nutrition entries yet"}),e.jsxs(x,{onClick:()=>{K(),g(!0)},variant:"outline",className:"gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Add First Entry"]})]}):e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 md:grid-cols-2",children:s.map(t=>e.jsxs(F,{className:"hover:shadow-md transition-shadow",children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(R,{className:"text-lg",children:t.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>X(t),children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>W(t.id),className:"text-red-600 hover:text-red-700",children:e.jsx(pe,{className:"w-4 h-4"})})]})]})}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-gray-600",children:"Calories:"}),e.jsx("span",{children:t.calories})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-gray-600",children:"Protein:"}),e.jsxs("span",{children:[t.protein,"g"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Carbs:"}),e.jsxs("span",{children:[t.carbs,"g"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-gray-600",children:"Fats:"}),e.jsxs("span",{children:[t.fats,"g"]})]}),t.fiber>0&&e.jsxs("div",{className:"col-span-2 text-xs text-gray-500",children:["Fiber: ",t.fiber,"g | Sodium: ",t.sodium,"mg"]})]})})]},t.id))})})]}),e.jsx(je,{open:h,onOpenChange:g,children:e.jsxs(ge,{children:[e.jsxs(fe,{children:[e.jsx(ve,{children:n?"Edit Nutrition Entry":"Add Nutrition Entry"}),e.jsx(ye,{children:n?"Update the nutritional information":"Add nutritional information for a meal"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"nutrition-name",children:"Item Name *"}),e.jsx(B,{id:"nutrition-name",value:u,onChange:t=>p(t.target.value),placeholder:"e.g., Grilled Chicken Breast"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"calories",children:"Calories *"}),e.jsx(B,{id:"calories",type:"number",value:v,onChange:t=>S(t.target.value),placeholder:"250"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"protein",children:"Protein (g) *"}),e.jsx(B,{id:"protein",type:"number",step:"0.1",value:b,onChange:t=>C(t.target.value),placeholder:"30"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"carbs",children:"Carbs (g) *"}),e.jsx(B,{id:"carbs",type:"number",step:"0.1",value:D,onChange:t=>T(t.target.value),placeholder:"15"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"fats",children:"Fats (g) *"}),e.jsx(B,{id:"fats",type:"number",step:"0.1",value:l,onChange:t=>w(t.target.value),placeholder:"10"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"fiber",children:"Fiber (g)"}),e.jsx(B,{id:"fiber",type:"number",step:"0.1",value:i,onChange:t=>j(t.target.value),placeholder:"5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"sodium",children:"Sodium (mg)"}),e.jsx(B,{id:"sodium",type:"number",step:"0.1",value:O,onChange:t=>_(t.target.value),placeholder:"500"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(x,{onClick:H,className:"flex-1 bg-orange-500 hover:bg-orange-600",disabled:!u||!v||!b||!D||!l,children:n?"Update Entry":"Add Entry"}),e.jsx(x,{variant:"outline",onClick:()=>{g(!1),K()},children:"Cancel"})]})]})]})})]})}function ds({accessToken:o}){const[s,d]=r.useState(null),[m,c]=r.useState(!1),[h,g]=r.useState("30days"),[n,N]=r.useState(void 0),[u,p]=r.useState(void 0),[v,S]=r.useState(!1),[b,C]=r.useState(!1);r.useEffect(()=>{D()},[h,n,u]);const D=async()=>{c(!0);try{let l=`https://${z}.supabase.co/functions/v1/make-server-493cc528/admin/analytics`;if(h==="custom"&&n&&u)l+=`?startDate=${A(n,"yyyy-MM-dd")}&endDate=${A(u,"yyyy-MM-dd")}`;else if(h!=="all"){const i=new Date;let j;switch(h){case"today":j=i;break;case"week":j=ze(i);break;case"month":j=Be(i);break;case"7days":j=ce(i,7);break;case"30days":j=ce(i,30);break;default:j=i}l+=`?startDate=${A(j,"yyyy-MM-dd")}&endDate=${A(i,"yyyy-MM-dd")}`}const w=await fetch(l,{headers:{Authorization:`Bearer ${o}`}});if(w.ok){const i=await w.json();d(i)}else{const i=await w.json();f.error(`Failed to fetch analytics: ${i.error}`)}}catch(l){console.error("Error fetching analytics:",l),f.error("An error occurred while fetching analytics")}finally{c(!1)}},T=()=>{if(!s){f.error("No data to export");return}const l=[["Cafeteria Analytics Report"],["Generated:",new Date().toLocaleString()],["Date Range:",h==="all"?"All Time":h==="custom"?`${A(n,"PP")} - ${A(u,"PP")}`:h],[],["Metric","Value"],["Total Users",s.totalUsers],["Total Students",s.totalStudents],["Total Transactions",s.totalTransactions],["Total Revenue (KES)",s.totalRevenue.toFixed(2)],["Average Transaction (KES)",s.averageTransactionValue.toFixed(2)],["Revenue per Student (KES)",s.totalStudents>0?(s.totalRevenue/s.totalStudents).toFixed(2):"0.00"]].map(O=>O.join(",")).join(`
`),w=new Blob([l],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),j=URL.createObjectURL(w);i.setAttribute("href",j),i.setAttribute("download",`cafeteria-analytics-${A(new Date,"yyyy-MM-dd")}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),f.success("Report exported successfully!")};return m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):s?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1 text-lg sm:text-xl",children:"Cafeteria Analytics"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Sales and revenue overview"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(x,{onClick:D,variant:"outline",className:"gap-2",size:"sm",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs(x,{onClick:T,className:"bg-orange-500 hover:bg-orange-600 gap-2",size:"sm",children:[e.jsx(Le,{className:"w-4 h-4"}),"Export Report"]})]})]}),e.jsxs(F,{children:[e.jsx(I,{children:e.jsx(R,{className:"text-base",children:"Date Range"})}),e.jsx($,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(Z,{value:h,onValueChange:g,children:[e.jsx(ee,{className:"w-full sm:w-[200px]",children:e.jsx(se,{})}),e.jsxs(ae,{children:[e.jsx(k,{value:"all",children:"All Time"}),e.jsx(k,{value:"today",children:"Today"}),e.jsx(k,{value:"7days",children:"Last 7 Days"}),e.jsx(k,{value:"30days",children:"Last 30 Days"}),e.jsx(k,{value:"week",children:"This Week"}),e.jsx(k,{value:"month",children:"This Month"}),e.jsx(k,{value:"custom",children:"Custom Range"})]})]}),h==="custom"&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(te,{open:v,onOpenChange:S,children:[e.jsx(re,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"gap-2 justify-start text-sm",children:[e.jsx(ne,{className:"w-4 h-4"}),n?A(n,"PP"):"Start Date"]})}),e.jsx(ie,{className:"w-auto p-0",children:e.jsx(le,{mode:"single",selected:n,onSelect:l=>{N(l),S(!1)},disabled:l=>l>new Date})})]}),e.jsxs(te,{open:b,onOpenChange:C,children:[e.jsx(re,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"gap-2 justify-start text-sm",children:[e.jsx(ne,{className:"w-4 h-4"}),u?A(u,"PP"):"End Date"]})}),e.jsx(ie,{className:"w-auto p-0",children:e.jsx(le,{mode:"single",selected:u,onSelect:l=>{p(l),C(!1)},disabled:[{after:new Date},...n?[{before:n}]:[]]})})]})]})]})})]}),e.jsxs("div",{className:"grid gap-3 sm:gap-4 grid-cols-2 lg:grid-cols-4",children:[e.jsxs(F,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(R,{className:"text-sm",children:"Total Revenue"}),e.jsx(Oe,{className:"w-4 h-4 text-gray-500"})]}),e.jsxs($,{children:[e.jsxs("div",{className:"text-orange-600",children:["KES ",s.totalRevenue.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Sales income"})]})]}),e.jsxs(F,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(R,{className:"text-sm",children:"Transactions"}),e.jsx(_e,{className:"w-4 h-4 text-gray-500"})]}),e.jsxs($,{children:[e.jsx("div",{className:"text-orange-600",children:s.totalTransactions}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total sales"})]})]}),e.jsxs(F,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(R,{className:"text-sm",children:"Avg Sale"}),e.jsx(Ke,{className:"w-4 h-4 text-gray-500"})]}),e.jsxs($,{children:[e.jsxs("div",{className:"text-orange-600",children:["KES ",s.averageTransactionValue.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Per transaction"})]})]}),e.jsxs(F,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(R,{className:"text-sm",children:"Active Students"}),e.jsx(Pe,{className:"w-4 h-4 text-gray-500"})]}),e.jsxs($,{children:[e.jsx("div",{className:"text-orange-600",children:s.totalStudents}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Registered"})]})]})]}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 md:grid-cols-2",children:[e.jsxs(F,{children:[e.jsxs(I,{children:[e.jsx(R,{children:"Performance Metrics"}),e.jsx(q,{children:"Key business indicators"})]}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Transaction Rate"}),e.jsxs("span",{children:[s.totalStudents>0?(s.totalTransactions/s.totalStudents*100).toFixed(1):0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full",style:{width:`${Math.min(s.totalStudents>0?s.totalTransactions/s.totalStudents*100:0,100)}%`}})})]}),e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Revenue per Student"}),e.jsxs("span",{className:"text-orange-600",children:["KES ",s.totalStudents>0?(s.totalRevenue/s.totalStudents).toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Customers"}),e.jsx("span",{className:"text-orange-600",children:s.totalUsers})]})]})]})]}),e.jsxs(F,{children:[e.jsxs(I,{children:[e.jsx(R,{children:"Business Summary"}),e.jsx(q,{children:"Overview of operations"})]}),e.jsx($,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Revenue"}),e.jsxs("p",{className:"text-green-700 text-xl",children:["KES ",s.totalRevenue.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Transactions"}),e.jsx("p",{className:"text-blue-700",children:s.totalTransactions})]}),e.jsxs("div",{className:"p-3 bg-purple-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Avg Value"}),e.jsxs("p",{className:"text-purple-700",children:["KES ",s.averageTransactionValue.toFixed(2)]})]})]}),e.jsx("div",{className:"pt-3 border-t text-sm text-gray-600",children:e.jsxs("p",{children:["Serving ",e.jsx("strong",{className:"text-orange-600",children:s.totalStudents})," students with quality meals"]})})]})})]})]})]}):e.jsx(F,{children:e.jsx($,{className:"py-12",children:e.jsx("p",{className:"text-center text-gray-500",children:"No analytics data available"})})})}function ps({user:o,profile:s,accessToken:d,onSignOut:m}){const[c,h]=r.useState("menu"),g=[{id:"menu",label:"Menu",icon:de},{id:"nutrition",label:"Nutrition",icon:Ye},{id:"analytics",label:"Analytics",icon:He},{id:"profile",label:"Profile",icon:We}];return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b sticky top-0 z-10",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-orange-500 p-2 rounded-lg",children:e.jsx(de,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg text-orange-600",children:"MealPal"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Cafeteria Admin"})]})]}),e.jsxs(Fe,{children:[e.jsx($e,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"sm",className:"md:hidden",children:e.jsx(Ie,{className:"w-5 h-5"})})}),e.jsx(Re,{children:e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Signed in as"}),e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email})]}),e.jsxs(x,{onClick:m,variant:"outline",className:"w-full gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Sign Out"]})]})})]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:m,className:"hidden md:flex gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Sign Out"]})]})})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 md:py-8",children:[c==="menu"&&e.jsx(cs,{accessToken:d}),c==="nutrition"&&e.jsx(os,{accessToken:d}),c==="analytics"&&e.jsx(ds,{accessToken:d}),c==="profile"&&e.jsx(Ve,{profile:s,accessToken:d})]})}),e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg md:hidden z-20",children:e.jsx("div",{className:"grid grid-cols-4",children:g.map(n=>{const N=n.icon,u=c===n.id;return e.jsxs("button",{onClick:()=>h(n.id),className:`flex flex-col items-center gap-1 py-3 px-2 transition-colors ${u?"text-orange-600 bg-orange-50":"text-gray-600 hover:text-orange-500"}`,children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:n.label})]},n.id)})})})]})}export{ps as CafeteriaAdminDashboard};
